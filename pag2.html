<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Detalii Parcare — ParkingApp</title>
  <link rel="stylesheet" href="stylepg2.css">
</head>
<body>
 <header>
  <div class="header-left">
    <h1>Detalii parcare</h1>
    <p>Zona selectată: <strong id="selectedZoneLabel">—</strong></p>
  </div>
  <div class="header-right">
    <button id="backToMapBtn" type="button">⬅️ Înapoi la hartă</button>
  </div>
</header>

  <main>
    <section id="parking-info">
      <h2 id="parkingName">Nume Parcare</h2>
      <p id="parkingDescription">
        Aici poți adăuga descrierea parcării (număr locuri, program, facilități, etc.).
      </p>

      <div id="panorama">
        <h3>Panoramă 360°</h3>
        <div class="panorama-container">
          <!-- Panorama Google Street View (schimbată mai jos din script) -->
          <iframe id="panoramaFrame"
            src="https://www.google.com/maps/embed?pb=!4v1715000000000!6m8!1m7!1sCAoSLEFGMVFpcE1xSmhGSWwxQ0dCQ2FzdkpXQ0ZBbF9ES3ZIM0oxMVd6ZFFzZk5C!2m2!1d45.644!2d25.588!3f0!4f0!5f0.7820865974627469"
            allowfullscreen loading="lazy"></iframe>
        </div>
        <p class="hint">Poți roti și mări imaginea pentru a explora parcarea în 360°.</p>
      </div>
    </section>

    <section id="booking">
      <h2>Rezervă locul</h2>
      <p>Tarif/oră: <strong id="rateLabel">—</strong> RON</p>

      <div>
        <label for="startTime">Început (opțional)</label>
        <input id="startTime" type="datetime-local" name="startTime">
      </div>

      <fieldset>
        <legend>Durată</legend>
        <label for="hours">Ore</label>
        <input id="hours" type="number" min="0" max="72" value="1">

        <label for="minutes">Minute</label>
        <input id="minutes" type="number" min="0" max="59" step="15" value="0">

        <div>
          <button type="button" id="quick15">+15 min</button>
          <button type="button" id="quick30">+30 min</button>
          <button type="button" id="quick60">+1 h</button>
        </div>
      </fieldset>

      <section id="calculation">
        <h3>Calcul</h3>
        <p>Durată totală: <strong id="totalMinutesLabel">—</strong> minute (<span id="totalHoursLabel">—</span> ore)</p>
        <p>Total de plată: <strong id="totalPriceLabel">—</strong> RON</p>
      </section>

      <div>
        <button id="toPaymentBtn" type="button">Continuă la plată</button>
      </div>

      <div class="back-to-map">
  <button id="backToMapBtn" type="button">⬅️ Înapoi la hartă</button>
</div> 
    </section>
  </main>

  <footer>
    <p>ParkingApp — demo</p>
  </footer>

  <script>
    // === TARIFE ===
    const RATES = {
      "1": 3.00, // Zona 0 — Poiana Brașov
      "2": 3.00, // Zona 0 — Centrul Vechi
      "3": 2.00, // Zona 1 — Perimetru
      "4": 1.00  // Zona 2 — Periferie
    };

    const MIN_MINUTES = 15;

    // === ELEMENTE HTML ===
    const selectedZoneLabel = document.getElementById('selectedZoneLabel');
    const rateLabel = document.getElementById('rateLabel');
    const hoursInput = document.getElementById('hours');
    const minutesInput = document.getElementById('minutes');
    const totalMinutesLabel = document.getElementById('totalMinutesLabel');
    const totalHoursLabel = document.getElementById('totalHoursLabel');
    const totalPriceLabel = document.getElementById('totalPriceLabel');
    const toPaymentBtn = document.getElementById('toPaymentBtn');
    const quick15 = document.getElementById('quick15');
    const quick30 = document.getElementById('quick30');
    const quick60 = document.getElementById('quick60');
    const panoramaFrame = document.getElementById('panoramaFrame');

    // === FUNCȚII ===
    function getQueryParams() {
      const params = {};
      window.location.search.replace(/^\?/, '').split('&').forEach(p => {
        const [k, v] = p.split('=').map(decodeURIComponent);
        if (k) params[k] = v;
      });
      return params;
    }

    function formatCurrency(num) { return Number(num).toFixed(2); }

    function computeTotalMinutes() {
      const h = parseInt(hoursInput.value) || 0;
      const m = parseInt(minutesInput.value) || 0;
      let total = h * 60 + m;
      if (total < MIN_MINUTES) total = MIN_MINUTES;
      return total;
    }

    function updateCalculationUI() {
      const zone = currentZone;
      const rate = RATES[zone];
      rateLabel.textContent = formatCurrency(rate);
      const totalMinutes = computeTotalMinutes();
      const totalHours = totalMinutes / 60;
      const price = Math.round(rate * totalHours * 100) / 100;
      totalMinutesLabel.textContent = totalMinutes;
      totalHoursLabel.textContent = totalHours.toFixed(2);
      totalPriceLabel.textContent = formatCurrency(price);
    }

    // === BUTOANE SCURT ===
    quick15.addEventListener('click', () => {
      let mins = parseInt(minutesInput.value) || 0;
      let hrs = parseInt(hoursInput.value) || 0;
      mins += 15;
      if (mins >= 60) { hrs += Math.floor(mins / 60); mins = mins % 60; }
      hoursInput.value = hrs; minutesInput.value = mins; updateCalculationUI();
    });

    quick30.addEventListener('click', () => {
      let mins = parseInt(minutesInput.value) || 0;
      let hrs = parseInt(hoursInput.value) || 0;
      mins += 30;
      if (mins >= 60) { hrs += Math.floor(mins / 60); mins = mins % 60; }
      hoursInput.value = hrs; minutesInput.value = mins; updateCalculationUI();
    });

    quick60.addEventListener('click', () => {
      hoursInput.value = (parseInt(hoursInput.value) || 0) + 1;
      updateCalculationUI();
    });

    document.getElementById('backToMapBtn').addEventListener('click', () => {
  window.location.href = 'index.html';
});


    [hoursInput, minutesInput].forEach(el => el.addEventListener('input', updateCalculationUI));

    // === BUTON CONTINUĂ ===
    toPaymentBtn.addEventListener('click', () => {
      const zone = currentZone;
      const totalMinutes = computeTotalMinutes();
      const rate = RATES[zone];
      const price = Math.round(rate * (totalMinutes / 60) * 100) / 100;
      const startTime = document.getElementById('startTime').value || '';
      const params = new URLSearchParams({ zone, minutes: totalMinutes, price: price.toFixed(2), start: startTime });
      window.location.href = 'pag3.html?' + params.toString();
    });

    // === SINCRONIZARE ID ZONĂ ===
    let currentZone = "1";

    (function syncZoneId() {
      const params = new URLSearchParams(window.location.search);
      const zoneIdFromURL = params.get("zoneId");
      if (zoneIdFromURL) {
        try { sessionStorage.setItem("pf_zoneId", zoneIdFromURL); } catch (_) {}
      }
      const storedZoneId = sessionStorage.getItem("pf_zoneId");
      if (!zoneIdFromURL && storedZoneId) {
        try {
          const newUrl = new URL(window.location);
          newUrl.searchParams.set("zoneId", storedZoneId);
          window.history.replaceState({}, "", newUrl);
        } catch (_) {}
      }
    })();

    // === INIȚIALIZARE ===
    function init() {
      const params = getQueryParams();
      currentZone = params.zoneId || sessionStorage.getItem('pf_zoneId') || "1";

      const zoneNames = {
        "1": "Zona 0 — Poiana Brașov",
        "2": "Zona 0 — Centrul Vechi",
        "3": "Zona 1 — Perimetru",
        "4": "Zona 2 — Periferie"
      };

   const zonePanoramas = {
  "1": "https://www.google.com/maps/embed?pb=!4v1761507772501!6m8!1m7!1sPqX77EKCjUilzO8ODpbNcQ!2m2!1d45.59581823417588!2d25.55322354608915!3f217.67346640163797!4f0!5f0.7820865974627469", // Poiana Brașov - parcare telegondolă

  "2": "https://www.google.com/maps/embed?pb=!4v1730000100000!6m8!1m7!1sCAoSLEFGMVFpcE5sV2RSc09hRV9MbDFPZ0YwMmh4RkIzZ0hSMEoxcFhMR3pv!2m2!1d45.6415988!2d25.5880066!3f0!4f0!5f0.7820865974627469", // Centrul Vechi - Strada Republicii

  "3": "https://www.google.com/maps/embed?pb=!4v1715000000000!6m8!1m7!1sCAoSLEFGMVFpcE1jTVg5d2pTdVJ4R2lwc0dqYUpCN1ZKZUlRVjZud3djd1ZyV!2m2!1d45.658!2d25.599!3f0!4f0!5f0.7820865974627469", // Zona 1 - Perimetru (nemodificat)

  "4": "https://www.google.com/maps/embed?pb=!4v1761507995572!6m8!1m7!1sr3nKL-PFtiysbYTuUaRMWw!2m2!1d45.63200144857508!2d25.63647460447647!3f137.13140929642827!4f-1.5650080516300449!5f0.7820865974627469" // Periferie - strada Zizinului
};


      selectedZoneLabel.textContent = zoneNames[currentZone] || "Necunoscută";
      panoramaFrame.src = zonePanoramas[currentZone] || zonePanoramas["1"];

      if (params.name) {
        document.getElementById('parkingName').textContent = decodeURIComponent(params.name);
      }

      updateCalculationUI();
    }

    init();
  </script>
</body>
</html>